{% extends "base.html" %}
{% load staticfiles %}
{% block content %}
<div id="map" style="width: 100%; height: 400px;"></div>


<script>
var map;
var markers = [];
function initMap() {
    var position = {
      {% if location == "서울대입구" %}
      lat: 37.481423, lng:126.952766
      {% elif location == "홍대입구" %}
      lat:37.558326, lng:126.925566
      {% elif location == "강남역" %}
      lat:37.498214, lng:127.027621
      {% endif %}
    };
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: position
    });
    {% for cafe in cafe_list %}
      addMarker({{cafe.lat}},{{cafe.lng}},{{cafe.pk}},"{{cafe.name}}");
    {% endfor %}
}

function addMarker(cafe_lat,cafe_lng,cafe_pk,cafe_name){
    var marker = new google.maps.Marker({
        position: { lat : cafe_lat, lng : cafe_lng },
        map: map
    });
    var content = "<a href='/cafe/"+cafe_pk+"'>"+cafe_name+"</a>"
    var infowindow = new google.maps.InfoWindow()
    google.maps.event.addListener(marker,'click',(function(marker,content,infowindow){
        return function() {
           infowindow.setContent(content);
           infowindow.open(map,marker);
        };
    })(marker,content,infowindow));
    markers.push(marker);
  }

function setMapOnAll(map) {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  }
}

function clearMarkers() {
  setMapOnAll(null);
}

$(document).ready(function(){
  $("#all").click(function(){
  clearMarkers();
  {% for cafe in cafe_list %}
    addMarker({{cafe.lat}}, {{cafe.lng}}, {{cafe.pk}}, "{{cafe.name}}");
  {% endfor %}
});
  $("#smoke").click(function(){
  clearMarkers();
  {% for cafe in cafe_list %}
    {% if cafe.is_smoke %}
      addMarker({{cafe.lat}}, {{cafe.lng}}, {{cafe.pk}}, "{{cafe.name}}");

    {% endif %}
  {% endfor %}
});
  $("#plug").click(function(){
  clearMarkers();
  {% for cafe in cafe_list %}
    {% if cafe.is_plug %}
      addMarker({{cafe.lat}}, {{cafe.lng}}, {{cafe.pk}}, "{{cafe.name}}");
    {% endif %}
  {% endfor %}
});
  $("#wifi").click(function(){
  clearMarkers();
  {% for cafe in cafe_list %}
    {% if cafe.is_wifi %}
      addMarker({{cafe.lat}}, {{cafe.lng}}, {{cafe.pk}}, "{{cafe.name}}");
    {% endif %}
  {% endfor %}
});
  $("#24H").click(function(){
  clearMarkers();
  {% for cafe in cafe_list %}
    {% if cafe.is_24 %}
      addMarker({{cafe.lat}}, {{cafe.lng}}, {{cafe.pk}}, "{{cafe.name}}");
    {% endif %}
  {% endfor %}
});
  $("#parking").click(function(){
  clearMarkers();
  {% for cafe in cafe_list %}
    {% if cafe.is_parking %}
      addMarker({{cafe.lat}}, {{cafe.lng}}, {{cafe.pk}}, "{{cafe.name}}");
    {% endif %}
  {% endfor %}
});
});
</script>
<script type="text/javascript">


</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADYOYuou2GuChlOV2Kn75Eizfnq11IQg4&callback=initMap"></script>

<p>
{% if user.is_staff %}
<a href= "{% url 'cafe:cafe_new' %}">새 카페 추가</a>
{% endif %}
</p>

    <div class="container">
      <div class="row">
        <div class="col-sm-12" id="index_tabs">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs gallery__nav" role="tablist">
              <li  role="presentation">
                <a id="all" href="#" role="tab" data-toggle="tab" data-filter="*">
                  <span class="">ALL</span>
                </a>
              </li>
              <li  role="presentation">
                <a id="smoke" href="#" role="tab" data-toggle="tab" data-filter=".smoke">
                  <span class="">흡연</span>
                </a>
              </li>
              <li role="presentation">
                <a id="plug" href="#" role="tab" data-toggle="tab" data-filter=".plug">
                  <span class="">플러그</span>
                </a>
              </li>
              <li  role="presentation">
                <a id="wifi" href="#" role="tab" data-toggle="tab" data-filter=".wifi">
                  <span class="">WIFI</span>
                </a>
              </li>
              <li role="presentation">
                <a id="24H" href="#" role="tab" data-toggle="tab" data-filter=".24H">
                  <span class="">24H</span>
                </a>
              </li>
              <li role="presentation">
                <a id="parking" href="#" role="tab" data-toggle="tab" data-filter=".parking">
                  <span class="">주차</span>
                </a>
              </li>
            </ul>
        </div>
      </div> <!-- / .row -->

      <div class="row isotope-container">
        {% for cafe in cafe_list %}
        <div class="col-xs-12 isotope-item {% if cafe.is_smoke %}smoke {% endif%}{% if cafe.is_plug %}plug {% endif %}{% if cafe.is_wifi %}wifi {% endif %}{% if cafe.is_24 %}24H {% endif %}{% if cafe.is_parking %}parking {% endif %}">
          <a href="{% url 'cafe:cafe_detail' cafe.pk %}" class="thumbnail">
<!-- <div class="row list_div"> -->
            <div class="row">
              <div class="col-xs-4">
              {{cafe.name}}
              </div>
              <div class="col-xs-8">
                {% if cafe.is_smoke %}
                <i class="col-xs-2 fa fa-fire fa-1x" aria-hidden="true"></i>
                {% else %}
                <i class="col-xs-2 fa fa-fire fa-1x false false" aria-hidden="true"></i>
                {% endif %}
                {% if cafe.is_plug %}
                <i class="col-xs-2 fa fa-plug fa-1x" aria-hidden="true"></i>
                {% else %}
                <i class="col-xs-2 fa fa-plug fa-1x false" aria-hidden="true"></i>
                {% endif %}
                {% if cafe.is_wifi %}
                <i class="col-xs-2 fa fa-wifi fa-1x" aria-hidden="true"></i>
                {% else %}
                <i class="col-xs-2 fa fa-wifi fa-1x false" aria-hidden="true"></i>
                {% endif %}
                {% if cafe.is_24 %}
                <i class="col-xs-2 fa fa-moon-o fa-1x" aria-hidden="true"></i>
                {% else %}
                <i class="col-xs-2 fa fa-moon-o fa-1x false" aria-hidden="true"></i>
                {% endif %}
                {% if cafe.is_parking %}
                <i class="col-xs-2 fa fa-car fa-1x" aria-hidden="true"></i>
                {% else %}
                <i class="col-xs-2 fa fa-car fa-1x false" aria-hidden="true"></i>
                {% endif %}
              </div>
            </div>
          </a>
        </div>

        {% endfor %}
      </div>
      </div> <!-- / .row -->
    </div>
    <script src="{% static 'assets/js/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/js/imagesloaded.pkgd.min.js' %}"></script>

{% endblock %}